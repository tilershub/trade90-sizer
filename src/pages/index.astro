---
import BaseLayout from '../layouts/BaseLayout.astro';
import PositionSizer from '../components/PositionSizer.svelte';
import BlogCard from '../components/BlogCard.astro';
import { ghostClient } from '../lib/ghost';

// Fetch the 6 latest institutional analysis posts from Ghost
const posts = await ghostClient.posts.browse({ 
  limit: 6, 
  include: ['tags'] 
}).catch((err) => {
  console.error("Ghost Fetch Error:", err);
  return [];
});

// SEO Constants for TRADE90
const seoTitle = "Master Institutional Volatility-Adjusted Risk Tools";
const seoDescription = "Professional ADR-based position sizing tool for Forex, Gold, and Crypto. Trade with veteran risk management logic and institutional precision.";
---

<BaseLayout title={seoTitle} description={seoDescription}>
  
  <section class="py-12 px-4 border-b border-slate-900/50 bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] from-emerald-900/10 via-slate-950 to-slate-950">
    <div class="max-w-2xl mx-auto">
      <h1 class="sr-only">TRADE90 | Institutional Position Sizer & Volatility Analyzer</h1>
      
      <div class="bg-slate-900/40 rounded-[2.5rem] border border-slate-800/50 p-2 shadow-2xl backdrop-blur-sm transition-all hover:border-emerald-500/20">
        <PositionSizer client:load />
      </div>
    </div>
  </section>

  <section class="max-w-5xl mx-auto py-20 px-6">
    <div class="flex items-center justify-between mb-12">
      <header class="space-y-1">
        <h2 class="text-xl font-black border-l-4 border-emerald-500 pl-4 uppercase tracking-tighter text-slate-200">
          Latest Market Analysis
        </h2>
        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest pl-5">
          Volatility & Trend Reports
        </p>
      </header>
      
      <nav>
        <a href="/blog" class="group flex items-center gap-2 text-[10px] font-black text-emerald-500 uppercase tracking-widest hover:text-white transition-all">
          Explore All <span class="group-hover:translate-x-1 transition-transform">â†’</span>
        </a>
      </nav>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
      {posts.length > 0 ? posts.map((post) => (
        <article class="transition-transform duration-300 hover:-translate-y-1">
          <BlogCard 
            title={post.title}
            excerpt={post.excerpt}
            image={post.feature_image}
            slug={post.slug}
            date={post.published_at}
          />
        </article>
      )) : (
        <div class="col-span-full py-20 text-center border border-dashed border-slate-800 rounded-3xl bg-slate-900/10">
          <p class="text-slate-600 italic text-sm font-medium">
            Synchronizing with TRADE90 Intelligence... Check back shortly.
          </p>
        </div>
      )}
    </div>
  </section>

</BaseLayout>
