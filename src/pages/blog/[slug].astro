---
import BaseLayout from '../../layouts/BaseLayout.astro';
import FAQ from '../../components/FAQ.astro';
import { ghostClient } from '../../lib/ghost';

export async function getStaticPaths() {
  const posts = await ghostClient.posts.browse({ limit: 'all' });
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// VETERAN FIX: Ensure featured images load on tradeninety.com
const ghostSource = "https://trade90.ghost.io";
const finalFeatureImage = post.feature_image && !post.feature_image.startsWith('http') 
  ? `${ghostSource}${post.feature_image}` 
  : post.feature_image;
---

<BaseLayout title={post.title}>
  <main class="max-w-3xl mx-auto py-16 px-6 flex-grow">
    <article class="prose prose-invert prose-green max-w-none">
      
      <div class="flex items-center gap-4 mb-4">
        <time class="text-[10px] text-green-500 font-mono uppercase tracking-[0.2em] font-bold">
          {new Date(post.published_at).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
        </time>
        <span class="h-[1px] w-8 bg-slate-800"></span>
        <span class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Analysis</span>
      </div>
      
      <h1 class="text-3xl md:text-5xl font-black mt-2 mb-10 tracking-tighter uppercase leading-[1.1] text-white">
        {post.title}
      </h1>

      {post.feature_image && (
        <div class="relative group mb-12">
          <div class="absolute -inset-1 bg-gradient-to-r from-green-500/20 to-transparent rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
          <img 
            src={finalFeatureImage} 
            alt={post.title} 
            class="relative rounded-xl border border-slate-800 w-full shadow-2xl" 
          />
        </div>
      )}

      <div class="ghost-content text-slate-300 leading-relaxed" set:html={post.html} />
    </article>

    <div class="mt-24 pt-12 border-t border-slate-900">
      <FAQ />
    </div>
  </main>
</BaseLayout>

<style is:global>
  /* Optimized Content Styling for AdSense Readability */
  .ghost-content {
    @apply text-base md:text-lg;
  }
  .ghost-content h2 { 
    @apply text-2xl md:text-3xl font-black text-white mt-16 mb-6 uppercase tracking-tight border-l-4 border-green-500 pl-5; 
  }
  .ghost-content h3 {
    @apply text-xl font-bold text-slate-100 mt-10 mb-4;
  }
  .ghost-content p { 
    @apply mb-8 text-slate-400 leading-[1.8]; 
  }
  /* Handle images inside the content */
  .ghost-content img { 
    @apply rounded-xl border border-slate-800 my-12 shadow-lg; 
  }
  .ghost-content a { 
    @apply text-green-500 font-bold underline decoration-green-500/30 underline-offset-4 hover:text-white transition-colors; 
  }
  .ghost-content ul, .ghost-content ol {
    @apply mb-8 space-y-3 pl-5 border-l border-slate-800;
  }
  .ghost-content li {
    @apply text-slate-400;
  }
  /* Formatting for code/math blocks if used */
  .ghost-content pre {
    @apply bg-slate-900/50 border border-slate-800 p-6 rounded-xl my-8 overflow-x-auto;
  }
</style>
