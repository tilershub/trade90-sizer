---
import BaseLayout from '../../layouts/BaseLayout.astro';
import FAQ from '../../components/FAQ.astro';
import { ghostClient } from '../../lib/ghost';

export async function getStaticPaths() {
  const posts = await ghostClient.posts.browse({ limit: 'all' });
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const assetOrigin = "https://trade90.ghost.io";

// Fix Featured Image
const cleanFeatureImage = post.feature_image?.startsWith('http')
  ? post.feature_image.replace('https://tradeninety.com', assetOrigin).replace('https://www.tradeninety.com', assetOrigin)
  : `${assetOrigin}${post.feature_image}`;

// Fix all images inside the content
const cleanHtml = post.html?.replaceAll('src="/content/images/', `src="${assetOrigin}/content/images/`)
                           .replaceAll('https://tradeninety.com/content/images/', `${assetOrigin}/content/images/`)
                           .replaceAll('https://www.tradeninety.com/content/images/', `${assetOrigin}/content/images/`);
---

<BaseLayout title={post.title}>
  <main class="max-w-3xl mx-auto py-16 px-6 flex-grow">
    <article class="prose prose-invert prose-green max-w-none">
      <time class="text-[10px] text-green-500 font-mono uppercase tracking-[0.2em] font-bold mb-4 block">
        {new Date(post.published_at).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
      </time>
      
      <h1 class="text-3xl md:text-5xl font-black mt-2 mb-10 tracking-tighter uppercase text-white">
        {post.title}
      </h1>

      {post.feature_image && (
        <img src={cleanFeatureImage} alt={post.title} class="rounded-xl border border-slate-800 w-full mb-12" />
      )}

      <div class="ghost-content text-slate-300 leading-relaxed" set:html={cleanHtml} />
    </article>

    <div class="mt-20">
      <FAQ />
    </div>
  </main>
</BaseLayout>

<style is:global>
  .ghost-content h2 { @apply text-2xl font-black text-white mt-12 mb-6 border-l-4 border-green-500 pl-4 uppercase; }
  .ghost-content p { @apply mb-6 text-slate-400 leading-[1.8]; }
  .ghost-content img { @apply rounded-xl border border-slate-800 my-8; }
  .ghost-content a { @apply text-green-500 font-bold underline; }
</style>
